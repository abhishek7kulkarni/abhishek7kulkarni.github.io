<!DOCTYPE html>

<html>

<head>
<title>World Population</title>
<script src="https://d3js.org/d3.v4.min.js"></script>
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
</head>

<style>
.radio{
  text-align: center;
}
.row{
  text-align: center;
}
div.tooltip {
    position: absolute;
    text-align: center;
    width: 80px;
    height: 32px;
    padding: 2px;
    font: 12px sans-serif;
    background: lightsteelblue;
    border: 0px;
    border-radius: 8px;
    pointer-events: none;
}
a {
    text-decoration: none;
    display: inline-block;
    padding: 8px 16px;
    margin-left: 1300px;
    margin-top: 10px;
    margin-bottom: 50px;
}

a:hover {
    background-color: #ddd;
    color: black;
}

.previous {
    background-color: #003f5c;
    color: white;
}
</style>

<body>

<div class='container'>
  <div class='row'>
  <h2>World-o-pedia: World Population through the Ages</h2>
        <p>Select a year:</p>
          <div class='radio'>
            <label class='radio-inline'>
              <input type="radio" name="Year" value="P1960" onclick='changeyear(this.value)' checked> 1960
            </label>
            <label class='radio-inline'>
              <input type="radio" name="Year" value="P1961" onclick='changeyear(this.value)' checked> 1961
            </label>
            <label class='radio-inline'>
              <input type="radio" name="Year" value="P1962" onclick='changeyear(this.value)' checked> 1962
            </label>
            <label class='radio-inline'>
              <input type="radio" name="Year" value="P1963" onclick='changeyear(this.value)' checked> 1963
            </label>
            <label class='radio-inline'>
              <input type="radio" name="Year" value="P1964" onclick='changeyear(this.value)' checked> 1964
            </label>
            <label class='radio-inline'>
              <input type="radio" name="Year" value="P1965" onclick='changeyear(this.value)' checked> 1965
            </label>
            <label class='radio-inline'>
              <input type="radio" name="Year" value="P1966" onclick='changeyear(this.value)' checked> 1966
            </label>
            <label class='radio-inline'>
              <input type="radio" name="Year" value="P1967" onclick='changeyear(this.value)' checked> 1967
            </label>
            <label class='radio-inline'>
              <input type="radio" name="Year" value="P1968" onclick='changeyear(this.value)' checked> 1968
            </label>
            <label class='radio-inline'>
              <input type="radio" name="Year" value="P1969" onclick='changeyear(this.value)' checked> 1969
            </label>
            <label class='radio-inline'>
              <input type="radio" name="Year" value="P1970" onclick='changeyear(this.value)' checked> 1970
            </label>
            <label class='radio-inline'>
              <input type="radio" name="Year" value="P1971" onclick='changeyear(this.value)' checked> 1971
            </label>
            <label class='radio-inline'>
              <input type="radio" name="Year" value="P1972" onclick='changeyear(this.value)' checked> 1972
            </label>
            <label class='radio-inline'>
              <input type="radio" name="Year" value="P1973" onclick='changeyear(this.value)' checked> 1973
            </label>
            <label class='radio-inline'>
              <input type="radio" name="Year" value="P1974" onclick='changeyear(this.value)' checked> 1974
            </label>
            <label class='radio-inline'>
              <input type="radio" name="Year" value="P1975" onclick='changeyear(this.value)' checked> 1975
            </label>
            <label class='radio-inline'>
              <input type="radio" name="Year" value="P1976" onclick='changeyear(this.value)' checked> 1976
            </label>
            <label class='radio-inline'>
              <input type="radio" name="Year" value="P1977" onclick='changeyear(this.value)' checked> 1977
            </label>
            <label class='radio-inline'>
              <input type="radio" name="Year" value="P1978" onclick='changeyear(this.value)' checked> 1978
            </label>
            <label class='radio-inline'>
              <input type="radio" name="Year" value="P1979" onclick='changeyear(this.value)' checked> 1979
            </label>
            <label class='radio-inline'>
              <input type="radio" name="Year" value="P1980" onclick='changeyear(this.value)' checked> 1980
            </label>
            <label class='radio-inline'>
              <input type="radio" name="Year" value="P1981" onclick='changeyear(this.value)' checked> 1981
            </label>
            <label class='radio-inline'>
              <input type="radio" name="Year" value="P1982" onclick='changeyear(this.value)' checked> 1982
            </label>
            <label class='radio-inline'>
              <input type="radio" name="Year" value="P1983" onclick='changeyear(this.value)' checked> 1983
            </label>
            <label class='radio-inline'>
              <input type="radio" name="Year" value="P1984" onclick='changeyear(this.value)' checked> 1984
            </label>
            <label class='radio-inline'>
              <input type="radio" name="Year" value="P1985" onclick='changeyear(this.value)' checked> 1985
            </label>
            <label class='radio-inline'>
              <input type="radio" name="Year" value="P1986" onclick='changeyear(this.value)' checked> 1986
            </label>
            <label class='radio-inline'>
              <input type="radio" name="Year" value="P1987" onclick='changeyear(this.value)' checked> 1987
            </label>
            <label class='radio-inline'>
              <input type="radio" name="Year" value="P1988" onclick='changeyear(this.value)' checked> 1988
            </label>
            <label class='radio-inline'>
              <input type="radio" name="Year" value="P1989" onclick='changeyear(this.value)' checked> 1989
            </label>
            <label class='radio-inline'>
              <input type="radio" name="Year" value="P1990" onclick='changeyear(this.value)' checked> 1990
            </label>
            <label class='radio-inline'>
              <input type="radio" name="Year" value="P1991" onclick='changeyear(this.value)' checked> 1991
            </label>
            <label class='radio-inline'>
              <input type="radio" name="Year" value="P1992" onclick='changeyear(this.value)' checked> 1992
            </label>
            <label class='radio-inline'>
              <input type="radio" name="Year" value="P1993" onclick='changeyear(this.value)' checked> 1993
            </label>
            <label class='radio-inline'>
              <input type="radio" name="Year" value="P1994" onclick='changeyear(this.value)' checked> 1994
            </label>
            <label class='radio-inline'>
              <input type="radio" name="Year" value="P1995" onclick='changeyear(this.value)' checked> 1995
            </label>
            <label class='radio-inline'>
              <input type="radio" name="Year" value="P1996" onclick='changeyear(this.value)' checked> 1996
            </label>
            <label class='radio-inline'>
              <input type="radio" name="Year" value="P1997" onclick='changeyear(this.value)' checked> 1997
            </label>
            <label class='radio-inline'>
              <input type="radio" name="Year" value="P1998" onclick='changeyear(this.value)' checked> 1998
            </label>
            <label class='radio-inline'>
              <input type="radio" name="Year" value="P1999" onclick='changeyear(this.value)' checked> 1999
            </label>
            <label class='radio-inline'>
              <input type="radio" name="Year" value="P2000" onclick='changeyear(this.value)' checked> 2000
            </label>
            <label class='radio-inline'>
              <input type="radio" name="Year" value="P2001" onclick='changeyear(this.value)' checked> 2001
            </label>
            <label class='radio-inline'>
              <input type="radio" name="Year" value="P2002" onclick='changeyear(this.value)' checked> 2002
            </label>
            <label class='radio-inline'>
              <input type="radio" name="Year" value="P2003" onclick='changeyear(this.value)' checked> 2003
            </label>
            <label class='radio-inline'>
              <input type="radio" name="Year" value="P2004" onclick='changeyear(this.value)' checked> 2004
            </label>
            <label class='radio-inline'>
              <input type="radio" name="Year" value="P2005" onclick='changeyear(this.value)' checked> 2005
            </label>
            <label class='radio-inline'>
              <input type="radio" name="Year" value="P2006" onclick='changeyear(this.value)' checked> 2006
            </label>
            <label class='radio-inline'>
              <input type="radio" name="Year" value="P2007" onclick='changeyear(this.value)' checked> 2007
            </label>
            <label class='radio-inline'>
              <input type="radio" name="Year" value="P2008" onclick='changeyear(this.value)' checked> 2008
            </label>
            <label class='radio-inline'>
              <input type="radio" name="Year" value="P2009" onclick='changeyear(this.value)' checked> 2009
            </label>
            <label class='radio-inline'>
              <input type="radio" name="Year" value="P2010" onclick='changeyear(this.value)' checked> 2010
            </label>
            <label class='radio-inline'>
              <input type="radio" name="Year" value="P2011" onclick='changeyear(this.value)' checked> 2011
            </label>
            <label class='radio-inline'>
              <input type="radio" name="Year" value="P2012" onclick='changeyear(this.value)' checked> 2012
            </label>
            <label class='radio-inline'>
              <input type="radio" name="Year" value="P2013" onclick='changeyear(this.value)' checked> 2013
            </label>
            <label class='radio-inline'>
              <input type="radio" name="Year" value="P2014" onclick='changeyear(this.value)' checked> 2014
            </label>
            <label class='radio-inline'>
              <input type="radio" name="Year" value="P2015" onclick='changeyear(this.value)' checked> 2015
            </label>
            <label class='radio-inline'>
              <input type="radio" name="Year" value="P2016" onclick='changeyear(this.value)' checked> 2016
            </label>
            <label class='radio-inline'>
              <input type="radio" name="Year" value="P2017" onclick='changeyear(this.value)' checked> 2017
            </label>

          </div>
      <svg class='chart'>
      </svg>
  </div>
</div>
</body>

<script>

jsontxt = "";

var rawFile = new XMLHttpRequest();
    rawFile.open("GET", 'world_population.json', false);
    rawFile.onreadystatechange = function ()
    {
        if(rawFile.readyState === 4)
        {
            if(rawFile.status === 200 || rawFile.status == 0)
            {
                jsontxt = rawFile.responseText
            }
        }
    }
    rawFile.send(null);
//console.log(JSON.parse(jsontxt));

var myobj = JSON.parse(jsontxt);

var CUR_YR = "2017";
var CUR_CNTRY = "";

function changeyear(yr){
  CUR_YR = yr.slice(1,);
  console.log(CUR_YR);
  var smalldata = {Population: []};
  for(var i in myobj) {
      var item = myobj[i];
      smalldata.Population.push({
          "Country" : item.Country,
          "P2000"  : item[yr]
      });
  }
  update(smalldata.Population);
}
//var smalldata = changeyear(currentYear);


      var ifrm = document.createElement("iframe");
        ifrm.setAttribute("src", "https://en.wikipedia.org");
        ifrm.style.width = "90%";
        ifrm.style.height = "1000px";
        ifrm.style.marginLeft = "75px";
        document.body.appendChild(ifrm);

function update(data){
  //set domain for the x axis
  xChart.domain(data.map(function(d){ return d.Country; }) );
  //set domain for y axis
  yChart.domain( [0, d3.max(data, function(d){ return +d.P2000; })] );

  //get the width of each bar
  var barWidth = width / data.length;

  //select all bars on the graph, take them out, and exit the previous data set.
  //then you can add/enter the new data set
  var bars = chart.selectAll(".bar")
          .remove()
          .exit()
          .data(data)
  //now actually give each rectangle the corresponding data
  bars.enter()
    .append("rect")
    .attr("class", "bar")
    .attr("x", function(d, i){ return i * barWidth + 1 })
    .attr("y", function(d){ return yChart( d.P2000); })
    .attr("height", function(d){ return height - yChart(d.P2000); })
    .attr("width", barWidth - 1)
    .attr("fill", function(d){
        return "rgb(0,63,92)"})
    .on("mouseover", function(actual, i) {
            d3.select(this).style("cursor", "pointer");
            div.transition()
                .duration(200)
                .style("opacity", .9);
            div .html(data[i].Country + "<br/>"  + data[i].P2000)
                .style("left", (d3.event.pageX) + "px")
                .style("top", (d3.event.pageY - 28) + "px");
            })
        .on("mouseout", function(d) {
            d3.select(this).style("cursor", "default");
            div.transition()
                .duration(500)
                .style("opacity", 0);
        })
    .on('click', function (actual, i) {
      console.log(data[i].Country);
      CUR_CNTRY = data[i].Country;

        ifrm.setAttribute("src", "https://en.wikipedia.org/wiki/" + CUR_YR + "_in_" + CUR_CNTRY);

    })
  //left axis
  chart.select('.y')
      .call(yAxis)
  //bottom axis
  chart.select('.xAxis')
    .attr("transform", "translate(0," + height + ")")
    .call(xAxis)
    .selectAll("text")
      .style("text-anchor", "end")
      .attr("dx", "-.8em")
      .attr("dy", ".15em")
      .attr("transform", function(d){
        return "rotate(-65)";
      })
      .style("font-size", "11px");

}//end update

// Define the div for the tooltip
var div = d3.select("body").append("div")
    .attr("class", "tooltip")
    .style("opacity", 0);

//set up chart
var margin = {top: 20, right: 20, bottom: 95, left: 100};
var width = 1000;
var height = 500;

var chart = d3.select(".chart")
        .attr("width", width + margin.left + margin.right)
        .attr("height", height + margin.top + margin.bottom)
        .append("g")
        .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

var xChart = d3.scaleBand()
        .range([0, width]);

var yChart = d3.scaleLinear()
        .range([height, 0]);

var xAxis = d3.axisBottom(xChart);
var yAxis = d3.axisLeft(yChart);

//set up axes
//left axis
  chart.append("g")
      .attr("class", "y axis")
      .call(yAxis)

  //bottom axis
  chart.append("g")
    .attr("class", "xAxis")
    .attr("transform", "translate(0," + height + ")")
    .call(xAxis)
    .selectAll("text")
      .style("text-anchor", "end")
      .attr("dx", "-.8em")
      .attr("dy", ".15em")
      .attr("transform", function(d){
        return "rotate(-65)";
      });

//add labels
chart
  .append("text")
  .attr("transform", "translate(-80," +  (height+margin.bottom)/2 + ") rotate(-90)")
  .text("Population")
  .style("font-size", "25px");

chart
  .append("text")
  .attr("transform", "translate(" + (width/2) + "," + (height + margin.bottom - 5) + ")")
  .text("Country")
  .style("font-size", "25px");

//use bothData to begin with
update(myobj);
</script>

</html>
